<!DOCTYPE html>
<html>
<head>
    <title>MCP Testing Suite V2 - Project Launcher</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1>🧪 MCP Testing Suite</h1>
                <p id="headerSubtitle">Spin up MCP sessions, test tools, monitor servers, and enforce policy—locally.</p>
            </div>
            <div class="mode-toggle">
                <button id="learningModeBtn" class="mode-btn learning-mode active" onclick="switchToLearningMode()">
                    🎓 Learning Mode
                </button>
                <button id="proModeBtn" class="mode-btn pro-mode" onclick="switchToProMode()">
                    ⚡ Pro Mode
                </button>
            </div>
        </div>
    </div>
    
    <!-- Adventure Chooser -->
    <div class="section">
        <!-- Learning Mode Tiles -->
        <div id="learningModeChooser">
            <div class="adventure-grid">
                <div class="adventure-tile learning-tile" onclick="startMCPBasics()">
                    <div class="tile-icon">🎓</div>
                    <div class="tile-title">LEARN MCP BASICS</div>
                    <div class="tile-subtitle">What is MCP and why test it?</div>
                    <div class="tile-meta">5-minute interactive tutorial</div>
                    <div class="learning-progress">Start here • 0% complete</div>
                </div>
                
                <div class="adventure-tile learning-tile" onclick="startGuidedTesting()">
                    <div class="tile-icon">🧪</div>
                    <div class="tile-title">GUIDED TESTING</div>
                    <div class="tile-subtitle">Test your first MCP tool step-by-step</div>
                    <div class="tile-meta">Walkthrough with explanations</div>
                    <div class="learning-progress">Beginner • 15 mins</div>
                </div>
                
                <div class="adventure-tile learning-tile" onclick="exploreExamples()">
                    <div class="tile-icon">📚</div>
                    <div class="tile-title">EXPLORE EXAMPLES</div>
                    <div class="tile-subtitle">Real MCP servers with commentary</div>
                    <div class="tile-meta">Curated examples • Best practices</div>
                    <div class="learning-progress">Intermediate • 20 mins</div>
                </div>
                
                <div class="adventure-tile learning-tile" onclick="troubleshootingHelp()">
                    <div class="tile-icon">🔍</div>
                    <div class="tile-title">TROUBLESHOOTING</div>
                    <div class="tile-subtitle">Common issues and solutions</div>
                    <div class="tile-meta">Interactive problem solver</div>
                    <div class="learning-progress">Reference guide</div>
                </div>
            </div>
            
            <div class="quick-actions">
                <button onclick="showWhatIsMCP()" class="btn-success">🤔 What is MCP?</button>
                <button onclick="showLearningPath()" class="btn-secondary">📋 My Learning Path</button>
                <button onclick="switchToProMode()" class="btn-secondary" style="opacity: 0.7;">Switch to Pro Mode</button>
            </div>
        </div>
        
        <!-- Pro Mode Tiles (Original) -->
        <div id="proModeChooser" style="display: none;">
            <div class="adventure-grid">
                <div class="adventure-tile" onclick="goToInteractive()">
                    <div class="tile-icon">🧪</div>
                    <div class="tile-title">INTERACTIVE</div>
                    <div class="tile-subtitle">Test MCP tools (Postman-style)</div>
                    <div class="tile-meta" id="interactiveMeta">Ready to start</div>
                    <div class="tile-demo" onclick="event.stopPropagation(); tryDemo('interactive')">Try demo</div>
                </div>
                
                <div class="adventure-tile" onclick="goToAPI()">
                    <div class="tile-icon">🔧</div>
                    <div class="tile-title">API MODE</div>
                    <div class="tile-subtitle">Headless & CI</div>
                    <div class="tile-meta" id="apiMeta">REST ready at /api</div>
                    <div class="tile-demo" onclick="event.stopPropagation(); tryDemo('api')">Try demo</div>
                </div>
                
                <div class="adventure-tile" onclick="goToMonitoring()">
                    <div class="tile-icon">📊</div>
                    <div class="tile-title">MONITORING</div>
                    <div class="tile-subtitle">Health & performance</div>
                    <div class="tile-meta" id="monitoringMeta">0 sessions running</div>
                    <div class="tile-demo" onclick="event.stopPropagation(); tryDemo('monitoring')">Try demo</div>
                </div>
                
                <div class="adventure-tile" onclick="goToEnterprise()">
                    <div class="tile-icon">🔒</div>
                    <div class="tile-title">ENTERPRISE</div>
                    <div class="tile-subtitle">Security & policy</div>
                    <div class="tile-meta" id="enterpriseMeta">Policy: OFF</div>
                    <div class="tile-demo" onclick="event.stopPropagation(); tryDemo('enterprise')">Try demo</div>
                </div>
            </div>
            
            <div class="quick-actions">
                <button onclick="resumeLastSession()" class="btn-secondary">Resume last session</button>
                <button onclick="selectProjectFolder()" class="btn-secondary">Select project folder</button>
                <button onclick="showAdvancedMode()" class="btn-secondary" style="opacity: 0.7;">Advanced mode</button>
            </div>
        </div>
    </div>

    <div class="section advanced-mode-hidden" id="projectScanner">
        <h2>📁 Project Scanner</h2>
        <div>
            <input type="text" id="scanPath" placeholder="/path/to/projects (leave empty for current directory)" style="width: 300px;">
            <button onclick="openFolderBrowser()">📂 Browse</button>
            <button onclick="scanProjects()">Scan for Projects</button>
            <button onclick="refreshSessions()" class="btn-secondary">Refresh Sessions</button>
        </div>
        
        <!-- Folder Browser Modal -->
        <div id="folderBrowser" style="display: none; background: white; border: 2px solid #2196F3; border-radius: 8px; padding: 20px; margin: 10px 0; max-height: 400px; overflow-y: auto;">
            <h3>📂 Select Project Directory</h3>
            <div id="currentPath" style="background: #f5f5f5; padding: 8px; border-radius: 4px; margin-bottom: 10px; font-family: monospace;"></div>
            <div id="folderList"></div>
            <div style="margin-top: 15px;">
                <button onclick="selectCurrentFolder()" class="btn-success">Select This Folder</button>
                <button onclick="closeFolderBrowser()" class="btn-secondary">Cancel</button>
            </div>
        </div>

        <!-- Server Selection Modal -->
        <div id="serverSelector" style="display: none; background: white; border: 2px solid #4caf50; border-radius: 8px; padding: 20px; margin: 10px 0; max-height: 500px; overflow-y: auto;">
            <h3>🎛️ Configure MCP Servers</h3>
            <div id="configInfo" style="background: #f5f5f5; padding: 10px; border-radius: 4px; margin-bottom: 15px;"></div>
            
            <div style="margin-bottom: 15px;">
                <label><input type="radio" name="filterMode" value="include" checked> Include selected servers only</label><br>
                <label><input type="radio" name="filterMode" value="exclude"> Exclude selected servers</label><br>
                <label><input type="radio" name="filterMode" value="all"> Use all servers (default)</label>
            </div>
            
            <div id="serverList" style="max-height: 250px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 4px;"></div>
            
            <div style="margin-top: 15px;">
                <button onclick="launchWithServerSelection()" class="btn-success">🚀 Launch with Selection</button>
                <button onclick="closeServerSelector()" class="btn-secondary">Cancel</button>
            </div>
        </div>
        
        <div id="projectResults"></div>
    </div>

    <div class="section advanced-mode-hidden" id="activeSessions">
        <h2>🎮 Active Testing Sessions</h2>
        <div id="activeSessions"></div>
    </div>

    <div class="section advanced-mode-hidden" id="manualLaunch">
        <h2>🔧 Manual Launch</h2>
        <div>
            <input type="text" id="manualProjectPath" placeholder="Project path" style="width: 300px;">
            <input type="text" id="manualConfigSource" placeholder="Config source path" style="width: 300px;">
            <select id="manualConfigType">
                <option value="project">Project Config</option>
                <option value="user">User Config</option>
                <option value="custom">Custom Config</option>
            </select>
            <button onclick="launchManual()" class="btn-success">Launch Testing Backend</button>
        </div>
    </div>

    <div class="section">
        <h2>🧪 MCP Postman - Tool Testing</h2>
        <div style="margin-bottom: 10px;">
            <button onclick="openMCPPostman()" class="btn-success">🚀 Open MCP Tool Tester</button>
            <span style="margin-left: 10px; color: #666; font-size: 0.9em;">Test MCP tools from active sessions</span>
        </div>
        
        <!-- What is MCP? Educational Modal -->
        <div id="whatIsMCPModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000;">
            <div style="background: white; margin: 3% auto; padding: 30px; width: 90%; max-width: 800px; border-radius: 12px; max-height: 85vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2>🤔 What is MCP? (Model Context Protocol)</h2>
                    <button onclick="closeWhatIsMCPModal()" class="btn-secondary">✕ Close</button>
                </div>
                
                <div class="mcp-explanation">
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                        <h3 style="margin-top: 0; color: #1976d2;">🧠 Think of MCP like this...</h3>
                        <p style="font-size: 1.1em; margin: 0;"><strong>MCP is like having superpowers for AI assistants!</strong></p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div style="background: #f9f9f9; padding: 16px; border-radius: 8px;">
                            <h4>🔧 Without MCP</h4>
                            <p>AI can only talk to you. It can't read files, search the web, or interact with your tools.</p>
                            <p style="color: #666; font-style: italic;">"Sorry, I can't actually check your files..."</p>
                        </div>
                        <div style="background: #e8f5e8; padding: 16px; border-radius: 8px;">
                            <h4>⚡ With MCP</h4>
                            <p>AI can use "tools" to read files, search the web, manage GitHub, and much more!</p>
                            <p style="color: #2e7d32; font-style: italic;">"Let me check your files and help fix that bug!"</p>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 25px;">
                        <h3>🎯 Real Examples:</h3>
                        <ul style="font-size: 1.05em; line-height: 1.6;">
                            <li><strong>📁 Filesystem MCP:</strong> AI can read, write, and organize your files</li>
                            <li><strong>🔍 Web Search MCP:</strong> AI can search the internet for current info</li>
                            <li><strong>💻 GitHub MCP:</strong> AI can create issues, review code, manage repos</li>
                            <li><strong>📊 Database MCP:</strong> AI can query and update databases</li>
                            <li><strong>🌐 API MCP:</strong> AI can call any REST API or web service</li>
                        </ul>
                    </div>
                    
                    <div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-top: 0; color: #ef6c00;">🧪 Why Test MCP Tools?</h3>
                        <p><strong>Before giving AI superpowers, you want to make sure they work correctly!</strong></p>
                        <ul>
                            <li>Test that your MCP tools work as expected</li>
                            <li>Debug issues before AI uses them</li>
                            <li>Understand what capabilities you're giving to AI</li>
                            <li>Ensure security and performance</li>
                        </ul>
                    </div>
                    
                    <div style="text-align: center; padding: 20px 0;">
                        <p style="font-size: 1.2em; margin-bottom: 20px;"><strong>Ready to start testing?</strong></p>
                        <button onclick="startMCPBasics()" class="btn-success" style="margin-right: 10px; padding: 12px 24px;">🎓 Start Learning</button>
                        <button onclick="startGuidedTesting()" class="btn-success" style="padding: 12px 24px;">🧪 Start Testing</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- MCP Postman Modal -->
        <div id="mcpPostmanModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
            <div style="background: white; margin: 5% auto; padding: 20px; width: 90%; max-width: 1200px; border-radius: 8px; max-height: 90vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>🧪 MCP Postman - Tool Testing</h2>
                    <button onclick="closeMCPPostman()" class="btn-secondary">✕ Close</button>
                </div>
                
                <!-- Session Selection -->
                <div style="margin-bottom: 20px; padding: 15px; background: #f0f8ff; border-radius: 5px;">
                    <label for="mcpSessionSelect"><strong>Select Active Session:</strong></label>
                    <select id="mcpSessionSelect" onchange="loadMCPServers()" style="margin-left: 10px; width: 300px;">
                        <option value="">Choose a session...</option>
                    </select>
                    <button onclick="refreshMCPSessions()" class="btn-secondary" style="margin-left: 10px;">🔄 Refresh</button>
                </div>
                
                <!-- Server Discovery Panel -->
                <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <div style="flex: 1; background: #f9f9f9; padding: 15px; border-radius: 5px;">
                        <h3>📋 MCP Servers</h3>
                        <div id="mcpServersList">
                            <p style="color: #666;">Select a session to discover MCP servers</p>
                        </div>
                    </div>
                    
                    <div style="flex: 2; background: #f9f9f9; padding: 15px; border-radius: 5px;">
                        <h3>🔧 Tools</h3>
                        <div id="mcpToolsList">
                            <p style="color: #666;">Select a server to view available tools</p>
                        </div>
                    </div>
                </div>
                
                <!-- Tool Testing Panel -->
                <div style="background: #f0f8ff; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h3>⚡ Tool Tester</h3>
                    <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                        <div style="flex: 1;">
                            <label for="testServerName"><strong>Server:</strong></label><br>
                            <input type="text" id="testServerName" placeholder="Select server from list" style="width: 100%;" readonly>
                        </div>
                        <div style="flex: 1;">
                            <label for="testToolName"><strong>Tool:</strong></label><br>
                            <input type="text" id="testToolName" placeholder="Select tool from list" style="width: 100%;" readonly>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label for="testArguments"><strong>Arguments (JSON):</strong></label><br>
                        <textarea id="testArguments" placeholder='{"param1": "value1", "param2": 123}' style="width: 100%; height: 100px; font-family: monospace;"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label for="testDescription"><strong>Description (optional):</strong></label><br>
                        <input type="text" id="testDescription" placeholder="Describe this test..." style="width: 100%;">
                    </div>
                    
                    <div>
                        <button onclick="executeMCPTool()" class="btn-success">🚀 Execute Tool</button>
                        <button onclick="generateSampleRequest()" class="btn-secondary">📝 Generate Sample</button>
                        <button onclick="clearToolTester()" class="btn-secondary">🧹 Clear</button>
                    </div>
                </div>
                
                <!-- Results Panel -->
                <div style="background: #f9f9f9; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h3>📊 Results</h3>
                    <div id="mcpResults">
                        <p style="color: #666;">Execute a tool to see results here</p>
                    </div>
                </div>
                
                <!-- History Panel -->
                <div style="background: #fff; border: 1px solid #ddd; padding: 15px; border-radius: 5px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h3>📈 Request History</h3>
                        <div>
                            <button onclick="refreshMCPHistory()" class="btn-secondary">🔄 Refresh</button>
                            <button onclick="clearMCPHistory()" class="btn-secondary">🗑️ Clear History</button>
                        </div>
                    </div>
                    <div id="mcpHistory" style="max-height: 300px; overflow-y: auto;">
                        <p style="color: #666;">No requests in history</p>
                    </div>
                </div>
            </div>
        </div>
    <script src="/static/templates.js"></script>
    <script src="/static/script.js"></script>
</body>
</html>